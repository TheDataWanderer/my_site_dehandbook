# CASE WHEN ะฒ PostgreSQL - ะฟะพะดัะพะฑะฝะฐั ัะฟะฐัะณะฐะปะบะฐ

`CASE` - ะพะดะฝะพ ะธะท ัะฐะผัั ัะฝะธะฒะตััะฐะปัะฝัั ะธ ะฝะตะดะพะพัะตะฝัะฝะฝัั ะฒััะฐะถะตะฝะธะน ะฒ PostgreSQL. ย

ะก ะตะณะพ ะฟะพะผะพััั ะผะพะถะฝะพ ัะตะฐะปะธะทะพะฒัะฒะฐัั ััะปะพะฒะฝัั ะปะพะณะธะบั **ะฟััะผะพ ะฒะฝัััะธ SQL**: ะฑะตะท ะฟัะพัะตะดัั, ะฑะตะท IF, ะฑะตะท ะปะธัะฝะธั JOIN.  

ะ PostgreSQL ัััะตััะฒัะตั **ะดะฒะฐ ัะธะฝัะฐะบัะธัะตัะบะธั ะฒะฐัะธะฐะฝัะฐ CASE**:  

1. **CASE ั ะฒััะฐะถะตะฝะธะตะผ** (simple CASE)
2. **CASE ะฑะตะท ะฒััะฐะถะตะฝะธั** (searched CASE)  

ะะฝะธ ะฟะพัะพะถะธ ะฒะฝะตัะฝะต, ะฝะพ **ัะตัะฐัั ัะฐะทะฝัะต ะทะฐะดะฐัะธ**.  

---
## 1. CASE ั ะฒััะฐะถะตะฝะธะตะผ (simple CASE) 

### ะกะธะฝัะฐะบัะธั  

```sql
CASE <expression>
ย ย WHEN <value_1> THEN <result_1>
ย ย WHEN <value_2> THEN <result_2>
ย ย ...
ย ย ELSE <default_result>
END
```
### ะัะธะผะตั: 
```sql
CASE status
ย ย WHEN 'new' THEN 'ะะพะฒัะน'
ย ย WHEN 'in_progress' THEN 'ะ ัะฐะฑะพัะต'
ย ย WHEN 'done' THEN 'ะะฐะฒะตัััะฝ'
ย ย ELSE 'ะะตะธะทะฒะตััะฝะพ'
END
```
### ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั
* `<expression>` ะฒััะธัะปัะตััั **ะพะดะธะฝ ัะฐะท**
* ะบะฐะถะดัะน `WHEN` - ััะพ **ะฟัะพะฒะตัะบะฐ ะฝะฐ ัะฐะฒะตะฝััะฒะพ**  

ะคะฐะบัะธัะตัะบะธ PostgreSQL ะดะตะปะฐะตั ะฟัะธะผะตัะฝะพ ัะปะตะดัััะตะต:
```sql
status = 'new'
status = 'in_progress'
status = 'done'
```

---
### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั simple CASE 

โ๏ธ ะะฐะฟะฟะธะฝะณ ะทะฝะฐัะตะฝะธะน
โ๏ธ ะกัะฐัััั
โ๏ธ ะะพะดั, ัะธะฟั, ะบะฐัะตะณะพัะธะธ
โ๏ธ ะกะฟัะฐะฒะพัะฝะธะบะธ 

ะัะธะผะตั ะธะท ะฟัะฐะบัะธะบะธ:  
```sql
CASE order_type
ย ย WHEN 1 THEN 'ะะพะทะฝะธัะฐ'
ย ย WHEN 2 THEN 'ะะฟั'
ย ย WHEN 3 THEN 'ะะพะดะฟะธัะบะฐ'
END
```

---
## 2. CASE ะฑะตะท ะฒััะฐะถะตะฝะธั (searched CASE)

### ะกะธะฝัะฐะบัะธั 

```sql
CASE
ย ย WHEN <condition_1> THEN <result_1>
ย ย WHEN <condition_2> THEN <result_2>
ย ย ...
ย ย ELSE <default_result>
END
```
### ะัะธะผะตั

```sql
CASE
ย ย WHEN amount < 0 THEN 'ะััะธัะฐัะตะปัะฝะพะต'
ย ย WHEN amount = 0 THEN 'ะะพะปั'
ย ย WHEN amount > 0 THEN 'ะะพะปะพะถะธัะตะปัะฝะพะต'
ย ย ELSE 'ะัะธะฑะบะฐ'
END
```
### ะะฐะบ ััะพ ัะฐะฑะพัะฐะตั
* **ะบะฐะถะดัะน WHEN - ะปะพะณะธัะตัะบะพะต ะฒััะฐะถะตะฝะธะต**
* ััะปะพะฒะธั ะผะพะณัั ะฑััั **ะปัะฑะพะน ัะปะพะถะฝะพััะธ** 

ะะพะฟัััะธะผะพ ะฒัั:
```sql
> < >= <=
IN / NOT IN
LIKE / ILIKE
ISNULL
EXISTS (subquery)
AND / OR / NOT
```

---
### ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั searched CASE 

โ๏ธ ะะธะฐะฟะฐะทะพะฝั ะทะฝะฐัะตะฝะธะน
โ๏ธ ะกะปะพะถะฝัะต ะฑะธะทะฝะตั-ะฟัะฐะฒะธะปะฐ
โ๏ธ ะะตัะบะพะปัะบะพ ะบะพะปะพะฝะพะบ ะฒ ััะปะพะฒะธะธ
โ๏ธ ะะพะผะฑะธะฝะธัะพะฒะฐะฝะฝะฐั ะปะพะณะธะบะฐ
โ๏ธ ะะฝะฐะปะธัะธัะตัะบะธะต ะทะฐะฟัะพัั 

ะัะธะผะตั:
```sql
CASE
ย ย WHEN amount > 1000 AND region = 'EU' THEN 'ะััะฟะฝัะน ะทะฐะบะฐะท'
ย ย WHEN amount > 500 THEN 'ะกัะตะดะฝะธะน ะทะฐะบะฐะท'
ย ย ELSE 'ะะฐะปัะน ะทะฐะบะฐะท'
END
```

---
## 3. ะงะฐััะฐั ะพัะธะฑะบะฐ ะฝะพะฒะธัะบะพะฒ โ

ะะพะฟััะบะฐ ะธัะฟะพะปัะทะพะฒะฐัั ััะปะพะฒะธะต ะฒ simple CASE:
```sql
CASE amount
ย ย WHEN amount > 100 THEN 'ะะพะปััะพะต'
END
```

โ **ะญัะพ ะฝะต ััะฐะฑะพัะฐะตั**, ะฟะพัะพะผั ััะพ:
* `WHEN` ะพะถะธะดะฐะตั **ะทะฝะฐัะตะฝะธะต**, ะฐ ะฝะต ััะปะพะฒะธะต
* ัะฐะบัะธัะตัะบะธ ััะพ ัะธัะฐะตััั ะบะฐะบ:

```sql
amount = (amount > 100)
```

---
### ะัะฐะฒะธะปัะฝัะน ะฒะฐัะธะฐะฝั โ๏ธ

```sql
CASE
ย ย WHEN amount > 100 THEN 'ะะพะปััะพะต'
END
```

---
## 4. CASE ะฒัะตะณะดะฐ ะฒะพะทะฒัะฐัะฐะตั ะพะดะฝะพ ะทะฝะฐัะตะฝะธะต

`CASE` - ััะพ **ะฒััะฐะถะตะฝะธะต**, ะฐ ะฝะต ะพะฟะตัะฐัะพั ัะฟัะฐะฒะปะตะฝะธั ะฟะพัะพะบะพะผ.

โ ะะฝ **ะพะฑัะทะฐะฝ ะฒะตัะฝััั ะพะดะฝะพ ะทะฝะฐัะตะฝะธะต** ะดะปั ัััะพะบะธ.

```sql
SELECT
ย ย CASE
ย ย ย ย WHEN score >= 90 THEN 'A'
ย ย ย ย WHEN score >= 80 THEN 'B'
ย ย ย ย ELSE 'C'
ย ย END AS grade
FROM exams;
```

---
## 5. ะขะธะฟ ัะตะทัะปััะฐัะฐ CASE

ะขะธะฟ ัะตะทัะปััะฐัะฐ ะพะฟัะตะดะตะปัะตััั **ะฟะพ ะฒัะตะผ THEN ะธ ELSE**.

```sql
CASE
ย ย WHEN condition THEN 1
ย ย ELSE 0
END
```
โก ัะธะฟ: `integer`

---

โ ะัะธะฑะบะฐ ัะธะฟะพะฒ:

```sql
CASE
ย ย WHEN condition THEN 1
ย ย ELSE 'ะฝะตั'
END
```

PostgreSQL ะฟะพะฟััะฐะตััั ะฟัะธะฒะตััะธ ัะธะฟั โ **ะพัะธะฑะบะฐ**

โ๏ธ ะะตัะตะฝะธะต - ัะฒะฝะพะต ะฟัะธะฒะตะดะตะฝะธะต:
```sql
CASE
ย ย WHEN condition THEN '1'
ย ย ELSE 'ะฝะตั'
END
```
ะธะปะธ
```sql
CASE
ย ย WHEN condition THEN 1
ย ย ELSE NULL
END
```

---
## 6. ELSE ะฝะตะพะฑัะทะฐัะตะปะตะฝ (ะฝะพ ะพะฟะฐัะตะฝ)

```sql
CASE
ย ย WHEN amount > 0 THEN 'ะะปัั'
END
```

ะัะปะธ ะฝะธ ะพะดะฝะพ ััะปะพะฒะธะต ะฝะต ััะฐะฑะพัะฐะตั โ ะฒะตัะฝัััั `NULL`.
๐ก **ะะตะบะพะผะตะฝะดะฐัะธั:**
ะัะตะณะดะฐ ัะฒะฝะพ ะฟะธัะฐัั `ELSE`, ะตัะปะธ `NULL` ะฝะต ัะฒะปัะตััั ะพะถะธะดะฐะตะผัะผ ัะตะทัะปััะฐัะพะผ.

---
## 7. ะะพััะดะพะบ WHEN ะธะผะตะตั ะทะฝะฐัะตะฝะธะต โ

ะัะพะฒะตัะบะฐ ะธะดัั **ัะฒะตััั ะฒะฝะธะท**.
ะะฐะบ ัะพะปัะบะพ ะฝะฐะนะดะตะฝะพ ะฟะตัะฒะพะต ัะพะฒะฟะฐะดะตะฝะธะต - `CASE` ะทะฐะฒะตััะฐะตััั.

โ ะัะธะฑะบะฐ:
```sql
CASE
ย ย WHEN amount > 0 THEN 'ะะพะปะพะถะธัะตะปัะฝะพะต'
ย ย WHEN amount > 100 THEN 'ะะพะปััะพะต'
END
```

`amount > 100` **ะฝะธะบะพะณะดะฐ ะฝะต ะฒัะฟะพะปะฝะธััั**.

โ๏ธ ะัะฐะฒะธะปัะฝะพ:
```sql
CASE
ย ย WHEN amount > 100 THEN 'ะะพะปััะพะต'
ย ย WHEN amount > 0 THEN 'ะะพะปะพะถะธัะตะปัะฝะพะต'
END
```

---
## 8. CASE ะฒะฝัััะธ ะฐะณัะตะณะฐัะฝัั ััะฝะบัะธะน

ะัะตะฝั ัะฐัััะน ะธ ะผะพัะฝัะน ะฟะฐััะตัะฝ ๐ก
### ะฃัะปะพะฒะฝะฐั ะฐะณัะตะณะฐัะธั

```sql
SUM(
ย ย CASE
ย ย ย ย WHEN status = 'done' THEN 1
ย ย ย ย ELSE 0
ย ย END
) AS done_count
```

ะธะปะธ ะบะพัะพัะต:

```sql
COUNT(*) FILTER (WHERE status = 'done')
```

---
### ะกัะผะผะฐ ะฟะพ ััะปะพะฒะธั

```sql
SUM(
ย ย CASE
ย ย ย ย WHEN type = 'income' THEN amount
ย ย ย ย ELSE 0
ย ย END
)
```

---
## 9. CASE ะฒ WHERE ะธ ORDER BY
### ะ WHERE

```sql
WHERE
ย ย CASE
ย ย ย ย WHEN is_admin THEN true
ย ย ย ย ELSE is_active
ย ย END
```

---
### ะ ORDER BY

```sql
ORDER BY
ย ย CASE status
ย ย ย ย WHEN 'urgent' THEN 1
ย ย ย ย WHEN 'normal' THEN 2
ย ย ย ย ELSE 3
ย ย END
```

---
## 10. ะัะฐะบัะธัะตัะบะฐั ัะตะบะพะผะตะฝะดะฐัะธั
* ะัะฟะพะปัะทัะน **CASE ั ะฒััะฐะถะตะฝะธะตะผ** - ะดะปั ะผะฐะฟะฟะธะฝะณะฐ ะทะฝะฐัะตะฝะธะน
* ะัะฟะพะปัะทัะน **CASE ะฑะตะท ะฒััะฐะถะตะฝะธั** - ะดะปั ะปะพะณะธะบะธ ะธ ะฟัะฐะฒะธะป
* ะะต ะฑะพะนัั ะดะปะธะฝะฝัั CASE - ะพะฝะธ ัะธัะฐะตะผะตะต ะฒะปะพะถะตะฝะฝัั IF
* ะกะปะตะดะธ ะทะฐ ัะธะฟะฐะผะธ
* ะะพะผะฝะธ ะฟัะพ ะฟะพััะดะพะบ WHEN
---
## ะัะฐัะบะพะต ัะตะทัะผะต

* ะ PostgreSQL **ะดะฒะฐ ัะฐะทะฝัั CASE**
* ะะฝะธ ัะตัะฐัั **ัะฐะทะฝัะต ะทะฐะดะฐัะธ**
* ะัะธะฑะบะธ ัะฐัะต ะฒัะตะณะพ ัะฒัะทะฐะฝั ั ะฒัะฑะพัะพะผ ะฝะตะฟัะฐะฒะธะปัะฝะพะณะพ ัะธะฝัะฐะบัะธัะฐ
* CASE ะพัะปะธัะฝะพ ัะฐะฑะพัะฐะตั ั ะฐะณัะตะณะฐัะฐะผะธ ะธ ะฐะฝะฐะปะธัะธะบะพะน
* ะญัะพ ะพะดะธะฝ ะธะท ะบะปััะตะฒัั ะธะฝััััะผะตะฝัะพะฒ ะฒ SQL-ะผััะปะตะฝะธะธ

---
๐ **ะกะพะฒะตั ะธะท ะฟัะฐะบัะธะบะธ**
ะัะปะธ ะปะพะณะธะบะฐ ะฝะฐัะธะฝะฐะตั ััะปะพะถะฝััััั, ะฟะพััะธ ะฒัะตะณะดะฐ ะฝัะถะตะฝ `CASE ะฑะตะท ะฒััะฐะถะตะฝะธั`.
`simple CASE` ะพััะฐะฒะปัะน ะดะปั ัะธััะพะณะพ ะธ ะฐะบะบััะฐัะฝะพะณะพ ะผะฐะฟะฟะธะฝะณะฐ.